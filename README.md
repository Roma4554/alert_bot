# Телеграм-бот для автоматического оповещания пользователей
___

## Описание 

Телеграмм-бот основан на API [Aiogram](https://docs.aiogram.dev/en/latest/index.html "Ссылка на документацию") 
и служит для внесения оповещений и их рассылке пользователям, предварительно зарегистрированных в боте.

## Как запустить
Все необходимые библиотеки для работы бота представлены в файле ***requirements.txt***.
Для запуска программы клонируйте репозиторий и установите перечисленные библиотеки: ```pip install -r requirements.txt```.

Значения токена телеграм-бота хранится в переменных окружения проекта ***.env***.
Запуск бота осуществляется командой ```python bot.py``` из терминала.


## Как пользоваться

### <u>Пользователь</u>

После ввода команды **/start** (отправляется автоматически при нажатии кнопки *"Старт"*) пользователю
отправляется приветственное сообщение в котором указано основное предназначение телеграмм-бота, а 
также основные команды, которые доступны пользователю. После чего пользователю необходимо ввести свой 
табельный номер, а также фамилию, имя и отчество через пробел для регистрации в базе данных 
и участии в рассылке.

Так же весь список команд, с их кратким описанием, доступен по кнопке *"Меню"* в 
левой части строки ввода сообщения.

**Пользователю доступны следующие команды:**
* **/help** - вызвать сообщение с подсказками команд
* **/change_id** - изменить табельный номер
* **/change_name** - изменить ФИО
* **/notifications** - запросить уведомления

После выбора необходимый команды у пользователя поочередно запрашивается необходимая информация. На каждом этапе
введенные данные валидируются и вносятся в базу данных.

В случае, если пользователь хочет отменить выбранную команду, то на любом этапе ее выполнения необходимо
нажать на кнопку *"Отмена"* под сообщением отправленным ботом.

### <u>Админимтратор</u>

Для получения статуса администратора введите команду ```\get_admin```, после чего введите пароль.

Стандартный пароль: **Admin123**, однако он может быть изменен в конфигурационном файле **settings.ini**.
В последующем пароль может быть изменен с помощью встроенной команды администратора.

**Пользователю после получения статуса администратору доступны дополнительные команды:**
* **/help_admin** - вызвать сообщение с подсказками для администратора
* **/change_time** - изменить время рассылки оповещений (по умолчанию: **10:00**)
* **/change_password** - изменить пароль (по умолчанию: **Admin123**)
* **/admin_list** - получить список администраторов
* **/fire_admin** - лишить пользователя прав администратора
* **/add_note** - добавить уведомление в базу данных c помощью сообщений в telegram
* **/add_db** - добавить уведомления в базу данных из загруженной xlsx таблицы (*d в комментарии к файлу предварительно 
***отчистит*** базу данных!)
* **/get_db** - получить весь список уведомлений из базы данных в виде xlsx таблицы

В случае, как и с командами обычных пользователей при выборе необходимый команды у пользователя поочередно запрашивается 
необходимая информация, которая валидируется и сохраняется.

При использовании команды ```/add_note``` добавление пользователь в список оповещения может
осуществляться путем ввода табельного номера или инициалов в формате **Фамилия И.О.** (регистр не учитывается).
После добавления всех необходимых пользователей, нажмите на кнопку *"Продолжить"* под сообщением.
Для добавления всех пользователей, на запрос добавить пользователя, отправьте сообщение ```all``` (регистр не учитывается)
после чего нажмите кнопку *"Продолжить"*. Далее поочередно будет запрошена дата оповещения, а так же сам текст.

При использовании команды ```/add_db``` у администратора запрашивается xlsx таблица вида:

* 1 строка - заголовок (столбцы: Табельный номер; Дата; Оповещение)
* Последующие строки - оповещения (число, ячейка в формате даты, текст)

В качестве шаблона можно использовать xlsx файл, получаемый при команде ```/get_db```.

На данный момент поддерживается HTML разметка при загрузке данных из xlsx таблицы.
При создании сообщения в телеграмм, сохраняется исходное форматирование текста.

